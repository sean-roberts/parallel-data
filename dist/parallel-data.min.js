// ParallelData v1.1.1 by Sean Roberts @DevelopSean
!function(){"use strict";var e="ParallelData";function t(){try{for(var t,n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];(t=console).error.apply(t,[e].concat(r))}catch(e){}}function n(e,t){if("function"==typeof Object.assign)return Object.assign.apply(Object,arguments);if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),r=1;r<arguments.length;r++){var o=arguments[r];if(null!=o)for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(n[a]=o[a])}return n}var r={},o={},a={},s=function(e,t){return e.toUpperCase()+"-"+t},i=function(e,t,o,i){var _=s(e,t);if(!r[_]){var c=new XMLHttpRequest,u=r[_]={url:t,method:e,headers:o,xhrRef:c,events:{load:null,error:null,timeout:null}};c.__PDInternal__=!0,c.open(e,t),o=n({},a.headers,o||{}),Object.keys(o).forEach(function(e){c.setRequestHeader(e,o[e])}),i&&i.onParallelDataResponse&&(console.log("set"),c.addEventListener("readystatechange",function(){console.log("internal",c.readyState),4===c.readyState&&i.onParallelDataResponse(c,{transferredToApp:!!c.__PDConsumed__})})),Object.keys(u.events).forEach(function(e){c.addEventListener(e,function(t){u.events[e]=t})}),c.send()}},_=function(e,r,i){var _=s(e,r);if(!o[_])var c=o[_]=fetch(r,n({},i,{__PDFetch__:!0,method:e,headers:n({},a.headers,i.headers||{}),credentials:i.credentials||"include",redirect:i.redirect||"follow"})).then(function(e){return i&&i.onParallelDataResponse&&i.onParallelDataResponse(e.clone(),{transferredToApp:!!c.__PDConsumed__}),e}).catch(function(e){throw t("fetch request failed",e),e})};function c(e,n){n=n||{};try{i("GET",e,n.headers,n)}catch(e){t("makeXHRRequest failed",e)}}function u(e,t){if(e&&e.method&&e.url){var n=s(e.method,e.url);return"xhr"===t?r[n]:o[n]}}!function(){try{var e=XMLHttpRequest.prototype;e.__PDListeners__=[],Object.keys(e).forEach(function(t){var r=Object.getOwnPropertyDescriptor(e,t);void 0===r.value&&Object.defineProperty(e,t,n({},r,{get:function(){return!this.__PDInternal__&&this.__PDRequest__?this.__PDRequest__[t]:r.get.call(this)}}))});var r=e.open;e.open=function(e,t){this.__PDOpen__={method:e,url:t},r.apply(this,arguments)};var o=e.addEventListener;e.addEventListener=function(){if(!this.__PDInternal__){if(this.__PDRequest__)return this.__PDRequest__.addEventListener.apply(this.__PDRequest__,arguments);this.__PDListeners__.push({action:"add",args:arguments})}return o.apply(this,arguments)};var a=e.removeEventListener;e.removeEventListener=function(){if(!this.__PDInternal__){if(this.__PDRequest__)return this.__PDRequest__.removeEventListener.apply(this.__PDRequest__,arguments);this.__PDListeners__.push({action:"remove",args:arguments})}return a.apply(this,arguments)};var s=e.send;e.send=function(e){var n=this,r=u(this.__PDOpen__,"xhr"),o=r&&r.xhrRef;this.__PDInternal__||!o||o.__PDConsumed__?(this.__PDListeners__=[],s.call(this,e)):(o.__PDConsumed__=!0,(window.setImmediate||window.setTimeout)(function(){try{for(o.onreadystatechange=n.onreadystatechange,["onloadstart","onprogress","onabort","onerror","onload","ontimeout","onloadend"].forEach(function(e){o[e]=n[e]});n.__PDListeners__.length;){var e=n.__PDListeners__.shift();o[e.action+"EventListener"].apply(o,e.args)}n.__PDRequest__=o,o.onreadystatechange&&o.onreadystatechange(),Object.keys(r.events).forEach(function(e){r.events[e]&&n.dispatchEvent(r.events[e])})}catch(e){t("transferring events failed",e)}},0))}}catch(e){t("failed to run XHRInterceptor",e)}}(),function(){try{var e=window.fetch;if(!e||!window.Promise)return;window.fetch=function(t,n){t=t||{},n=n||{};var r=void 0;"string"==typeof t?r=t:t.url&&(r=t.url);var o=u({method:n.method?n.method:t.method?t.method:"GET",url:r},"fetch");return!n.__PDFetch__&&o?(o.__PDConsumed__=!0,o):e.apply(window,arguments)}}catch(e){t("failed to run fetchInterceptor",e)}}(),window.ParallelData={version:"1.1.1",getForXHR:c,getForFetch:function(e,n){n=n||{};try{"fetch"in window&&"Promise"in window?_("GET",e,n):c(e,n)}catch(e){t("fetch request failed",e)}},configure:function(e){var t;(e=e||{}).allRequests&&(t=e.allRequests,a=n({},a,t||{}))}}}();
